<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clientes</title>
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous">
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <link rel="stylesheet" href="clientes.css">

    <!--   
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    -->
  </head>
  <body style="background-color: rgb(37, 37, 37);padding-top: 30px;">
    <div class="container" style="padding-top: 20px; background-color:
      aliceblue; border-radius: 10px;">
      <div class="row">
        <div class="col" style="text-align: center;">
          <button class="btn btn-dark btn-lg btn-block" id="create-user">Alta</button>
        </div>
        <div class="col" style="text-align: center;">
          <button class="btn btn-dark btn-lg btn-block" id="mod-user">Modificación</button>
        </div>
        <div class="col" style="text-align: center;">
          <button class="btn btn-dark btn-lg btn-block" id="btElimina">Baja</button>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label for="fNombre">Filtro: </label>
          <input type="text" name="fNombre" id="fNombre">
        </div>
        <div class="col">
          <label for="fApellidos">Campo: </label>
          <select name="filtro" id="filtro">
            <option value="0">Nombre</option>
            <option value="1">Apellidos</option>
            <option value="2">Telefono</option>
            <option value="3">Provincia</option>
            <option value="4">Localidad</option>
            <option value="5">Codigo Postal</option>
            <option value="6">Tipo</option>
          </select>
          <button type="button" class="btn btn-primary" id="btFiltra">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
              <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"></path>
            </svg>
            Filtra
          </button>
        </div>
        <div class="col">
          <label for="polizas"></label>
          <button id="polizas" onclick="window.location.href = 'polizas.html';" class="btn btn-secondary btn-lg btn-block">Ver pólizas</button>
        </div>
      </div>

      <div class="row">
        <div class="col table-responsive">
          <table class="table table-hover table-bordered border-danger" id="tablaClientes">
            <thead>
              <th>Nombre</th>
              <th>Apellidos</th>
              <th>Teléfono</th>
              <th>Provincia</th>
              <th>Localidad</th>
              <th>Código Postal</th>
              <th>Tipo</th>
            </thead>
            <tbody>
              <tr>
                <td>Juan</td>
                <td>Soriano Pérez</td>
                <td>+12 234 12 23 12</td>
                <td>Extremadura</td>
                <td>Merida</td>
                <td>23345</td>
                <td>Particular</td>
              </tr>
              <tr>
                <td>Pepe</td>
                <td>López Melendi</td>
                <td>+12 234 12 23 12</td>
                <td>Huelva</td>
                <td>Lepe</td>
                <td>23345</td>
                <td>Particular</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>



    <!-- The Modal -->
    <div id="myModal" class="modal">

      <!-- Modal content -->
      <div class="modal-content">
        <p class="close">&times;</p>
        <form>
          <div class="form-row">
            <div class="form-group col-md-4">
              <label for="inputNombre">Nombre</label>
              <input type="text" class="form-control" id="inputNombre"
                placeholder="Nombre">
            </div>
            <div class="form-group col-md-8">
              <label for="inputApellidos">Apellidos</label>
              <input type="text" class="form-control" id="inputApellidos"
                placeholder="Apellidos">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="inputTelefono">Teléfono</label>
              <input type="tel" class="form-control" id="inputTelefono"
                placeholder="Teléfono">
            </div>
            <div class="form-group col-md-3">
              <label for="inputTelefono">Tipo</label>
              <select class="form-control" name="tipo" id="inputTipo">
                <option value="Particular" selected>Particular</option>
                <option value="Empresa">Empresa</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-4">
              <label for="inputProvincia">Provincia</label>
              <select class="form-control" name="provincia" id="inputProvincia">
                <option value="1">Araba/Álava</option>
                <option value="2">Albacete</option>
                <option value="3">Alicante/Alacant</option>
                <option value="4">Almería</option>
                <option value="5">Ávila</option>
                <option value="6">Badajoz</option>
                <option value="7">Balears, Illes</option>
                <option value="8">Barcelona</option>
                <option value="9">Burgos</option>
                <option value="10">Cáceres</option>
                <option value="11">Cádiz</option>
                <option value="12">Castellón/Castelló</option>
                <option value="13">Ciudad Real</option>
                <option value="14">Córdoba</option>
                <option value="15">A Coruña</option>
                <option value="16">Cuenca</option>
                <option value="17">Girona</option>
                <option value="18">Granada</option>
                <option value="19">Guadalajara</option>
                <option value="20">Gipuzkoa</option>
                <option value="21" selected>Huelva</option>
                <option value="22">Huesca</option>
                <option value="23">Jaén</option>
                <option value="24">León</option>
                <option value="25">Lleida</option>
                <option value="26">La Rioja</option>
                <option value="27">Lugo</option>
                <option value="28">Madrid</option>
                <option value="29">Málaga</option>
                <option value="30">Murcia</option>
                <option value="31">Navarra</option>
                <option value="32">Ourense</option>
                <option value="33">Asturias</option>
                <option value="34">Palencia</option>
                <option value="35">Las Palmas</option>
                <option value="36">Pontevedra</option>
                <option value="37">Salamanca</option>
                <option value="38">Santa Cruz de Tenerife</option>
                <option value="39">Cantabria</option>
                <option value="40">Segovia</option>
                <option value="41">Sevilla</option>
                <option value="42">Soria</option>
                <option value="43">Tarragona</option>
                <option value="44">Teruel</option>
                <option value="45">Toledo</option>
                <option value="46">Valencia/València</option>
                <option value="47">Valladolid</option>
                <option value="48">Bizkaia</option>
                <option value="49">Zamora</option>
                <option value="50">Zaragoza</option>
                <option value="51">Ceuta</option>
                <option value="52">Melilla</option>
              </select>
            </div>
            <div class="form-group col-md-4">
              <label for="inputLocalidad">Localidad</label>
              <input type="text" class="form-control" id="inputLocalidad"
                placeholder="Localidad">
            </div>
            <div class="form-group col-md-4">
              <label for="inputCodPostal">Código Postal</label>
              <input type="number" class="form-control" id="inputCodPostal"
                placeholder="Código Postal">
            </div>
          </div>

        </form>
        <button class="btn btn-secondary" id="btModal">Aceptar</button>
      </div>
    </div>

    <script>

var modal = document.getElementById("myModal");


var btn = document.getElementById("create-user");
var btFiltra = document.getElementById("btFiltra");
var btnMod = document.getElementById("mod-user");
var crearUsuario = document.getElementById("btModal");
var eliminaUsuario = document.getElementById("btElimina")
rows = document.getElementsByTagName('tr');
var selectedIndex = 1; 
cargaFilas();
function cargaFilas(){
  for (let index = 1; index < rows.length; index++) {
  rows[index].onclick = function(){
    console.log(index);
    selectedIndex = index;
  }  
}
}


var span = document.getElementsByClassName("close")[0];

 eliminaUsuario.onclick = function(){
  rows = document.getElementsByTagName("table")[0].rows;
  if(rows.length ==1){
    alert("No hay filas")
  }else{
    if(confirm("Seguro que desea borrar la columna seleccionada?")){
      document.getElementsByTagName("table")[0].deleteRow(selectedIndex);
      selectedIndex = 1;
    }
  }

 }
btn.onclick = function() {
  modal.style.display = "block";
  document.getElementById('inputNombre').value = "";
  document.getElementById('inputApellidos').value= "";
  document.getElementById('inputTelefono').value= "";
  document.getElementById("inputLocalidad").value=  "";
  document.getElementById("inputCodPostal").value=  "";
  document.getElementById('inputTipo').value= "Particular";
  crearUsuario.onclick = function(){
    insertaUsuario();
  }
}
btFiltra.onclick = function() {
  rows = document.getElementsByTagName("table")[0].rows;
  filtro = document.getElementById('filtro');
  selectedIndex = filtro.selectedIndex;
  const inputNombre = document.getElementById('fNombre').value;
  
  for (let index = 1; index < rows.length; index++) {
    const row = rows[index];
  const cell = row.cells[selectedIndex]; // obtener la celda de la columna 1
  const cellValue = cell.textContent || cell.innerText; // obtener el texto de la celda
  
  if (cellValue.trim().toLowerCase() === inputNombre.trim().toLowerCase()) {
    // la fila coincide con el valor del input
    // mostrar la fila
    row.style.display = '';
  } else {
    // la fila no coincide con el valor del input
    // ocultar la fila
    row.style.display = 'none';
  }
  
  } 
  if (inputNombre == ""){
    for (let index = 1; index < rows.length; index++) {
    const row = rows[index];
    row.style.display = '';
  
  } 
  }
}
btnMod.onclick = function() {
  rows = document.getElementsByTagName("table")[0].rows;
  if(rows.length ==1){
    alert("No hay filas");
    return;
  }
  
  cargaModificacion();

  modal.style.display = "block";
  crearUsuario.onclick = function(){
    modUsuario();
  }
}
function cargaModificacion(){
  var rows = document.getElementsByTagName("table")[0].rows;
  selectedRow = rows[selectedIndex];
  cells = selectedRow.cells;

  document.getElementById('inputNombre').value = cells[0].innerHTML;
  document.getElementById('inputApellidos').value= cells[1].innerHTML;
  document.getElementById('inputTelefono').value= cells[2].innerHTML;
/*
  select =  document.getElementById('inputProvincia')
  options = Array.from(select.options);
  optionToSelect = options.find(item => item.text ===cells[3].innerHTML);
  console.log(optionToSelect);
  optionToSelect.selected = true;
 */
  document.getElementById("inputLocalidad").value= cells[4].innerHTML;
  document.getElementById("inputCodPostal").value= cells[5].innerHTML;
  document.getElementById('inputTipo').value= cells[6].innerHTML;
}
function modUsuario(){
  nombre = document.getElementById('inputNombre').value;
  apellidos = document.getElementById('inputApellidos').value;
  telefono = document.getElementById('inputTelefono').value;
  sel = document.getElementById("inputProvincia");
  provincia= sel.options[sel.selectedIndex].text;

  localidad = document.getElementById("inputLocalidad").value;
  codigoPostal = document.getElementById("inputCodPostal").value;
  tipo = document.getElementById('inputTipo').value;

  console.log(selectedIndex);
  var rows = document.getElementsByTagName("table")[0].rows;
  selectedRow = rows[selectedIndex];
  cells = selectedRow.cells;

  cells[0].innerHTML = nombre;
  cells[1].innerHTML = apellidos;
  cells[2].innerHTML = telefono;
  cells[3].innerHTML = provincia;
  cells[4].innerHTML = localidad;
  cells[5].innerHTML = codigoPostal;
  cells[6].innerHTML = tipo;
  modal.style.display = "none";
}
function insertaUsuario(){
  nombre = document.getElementById('inputNombre').value;
  apellidos = document.getElementById('inputApellidos').value;
  telefono = document.getElementById('inputTelefono').value;
  sel = document.getElementById("inputProvincia");
  provincia= sel.options[sel.selectedIndex].text;

  localidad = document.getElementById("inputLocalidad").value;
  codigoPostal = document.getElementById("inputCodPostal").value;
  tipo = document.getElementById('inputTipo').value;

  var table = document.getElementById("tablaClientes");

var row = table.insertRow(1);

var cell1 = row.insertCell(0);
var cell2 = row.insertCell(1);
var cell3 = row.insertCell(2);
var cell4 = row.insertCell(3);
var cell5 = row.insertCell(4);
var cell6 = row.insertCell(5);
var cell7 = row.insertCell(6);

cell1.innerHTML = nombre;
cell2.innerHTML = apellidos;
cell3.innerHTML = telefono;
cell4.innerHTML = provincia;
cell5.innerHTML = localidad;
cell6.innerHTML = codigoPostal;
cell7.innerHTML = tipo;

modal.style.display = "none";
cargaFilas();
}
span.onclick = function() {
  modal.style.display = "none";
}

window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}


</script>
  </body>
</html>